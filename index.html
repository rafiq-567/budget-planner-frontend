<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Budget Planner</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Anime.js -->
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
</head>

<body class="min-h-screen bg-slate-100 flex items-center justify-center p-6 font-sans">

  <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-6">
    <h2 class="text-center text-2xl font-extrabold text-indigo-600 mb-4">
      Budget Planner
    </h2>

    <input
      id="name"
      placeholder="Your name"
      class="w-full border border-gray-300 rounded-lg p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    />

    <input
      id="amount"
      type="number"
      placeholder="Budget amount"
      class="w-full border border-gray-300 rounded-lg p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    />

    <input
      id="interest"
      placeholder="Interest"
      class="w-full border border-gray-300 rounded-lg p-3 mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500"
    />

    <button
      id="saveBtn"
      class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg shadow hover:bg-indigo-700 active:scale-95 transition"
    >
      Save Budget
    </button>

    <div id="list" class="mt-6 space-y-3"></div>
  </div>

<script>
  const API = "https://budget-planner-api.budget-planner-api.workers.dev";

  const nameInput = document.getElementById("name");
  const amountInput = document.getElementById("amount");
  const interestInput = document.getElementById("interest");
  const list = document.getElementById("list");
  const saveBtn = document.getElementById("saveBtn");

  function animateIn(el) {
    anime({
      targets: el,
      opacity: [0, 1],
      translateY: [10, 0],
      duration: 400,
      easing: "easeOutQuad"
    });
  }

  function animateOut(el) {
    return anime({
      targets: el,
      opacity: [1, 0],
      translateY: [0, 10],
      duration: 300,
      easing: "easeInQuad"
    }).finished;
  }

  function createItemHTML(budget, pending = false) {
    return `
      <div
        class="flex justify-between items-center bg-indigo-50 p-4 rounded-lg shadow-sm
               ${pending ? "opacity-60" : ""}"
        data-id="${budget.id}"
      >
        <div>
          <p class="font-bold text-indigo-800">${budget.name}</p>
          <p class="text-sm text-gray-700">$${budget.amount} (${budget.interest})</p>
        </div>

        <button
          onclick="deleteBudget('${budget.id}')"
          class="text-red-500 hover:text-red-700 font-medium"
        >
          Delete
        </button>
      </div>
    `;
  }

  async function saveBudget() {
    if (!nameInput.value || !amountInput.value) return;

    anime({
      targets: saveBtn,
      scale: [1, 0.95, 1],
      duration: 200,
      easing: "easeOutQuad"
    });

    const tempId = "temp-" + Date.now();

    const payload = {
      name: nameInput.value,
      amount: Number(amountInput.value),
      interest: interestInput.value
    };

    list.insertAdjacentHTML(
      "afterbegin",
      createItemHTML({ ...payload, id: tempId }, true)
    );

    const tempEl = list.querySelector(`[data-id="${tempId}"]`);
    animateIn(tempEl);

    nameInput.value = "";
    amountInput.value = "";
    interestInput.value = "";

    try {
      const res = await fetch(API + "/budget", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!res.ok) throw new Error();

      loadBudgets();
    } catch {
      alert("Failed to save budget");
      await animateOut(tempEl);
      tempEl.remove();
    }
  }

  async function loadBudgets() {
    const res = await fetch(API + "/budget?ts=" + Date.now());
    const data = await res.json();

    list.innerHTML = "";

    data.forEach(budget => {
      list.insertAdjacentHTML("beforeend", createItemHTML(budget));
      animateIn(list.lastElementChild);
    });
  }

  async function deleteBudget(id) {
    const el = document.querySelector(`[data-id="${id}"]`);
    if (!el) return;

    await animateOut(el);
    el.remove();

    fetch(API + "/budget/" + id, { method: "DELETE" });
  }

  saveBtn.addEventListener("click", saveBudget);
  loadBudgets();
</script>

</body>
</html>
