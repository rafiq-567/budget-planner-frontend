<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Planner Pro</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
</head>

<body class="bg-[#f0f2f5] p-6 md:p-12 font-sans">

  <div class="max-w-[450px] mx-auto bg-white p-6 rounded-2xl shadow-2xl border border-gray-100">
    <h2 class="text-center text-indigo-600 text-3xl font-extrabold mb-6 tracking-tight">Budget Planner</h2>

    <div class="space-y-3">
        <input id="name" class="w-full p-3 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-all placeholder:text-gray-400" placeholder="Expense Name" />
        <input id="amount" type="number" class="w-full p-3 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-all placeholder:text-gray-400" placeholder="Amount ($)" />
        <input id="interest" class="w-full p-3 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-400 transition-all placeholder:text-gray-400" placeholder="Notes/Interest" />

        <button id="saveBtn" class="w-full p-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 active:scale-95 transition-transform shadow-lg shadow-indigo-200">
            Save Budget
        </button>
    </div>

    <div id="list" class="mt-8 space-y-4">
        </div>
  </div>

<script>
  const API = "https://budget-planner-api.budget-planner-api.workers.dev";

  const nameInput = document.getElementById("name");
  const amountInput = document.getElementById("amount");
  const interestInput = document.getElementById("interest");
  const list = document.getElementById("list");
  const saveBtn = document.getElementById("saveBtn");

  // --- ENHANCED ANIMATIONS ---

  function animateListIn() {
    // Staggered entrance for all items in the list
    anime({
      targets: '.item',
      opacity: [0, 1],
      translateX: [-20, 0],
      delay: anime.stagger(100), 
      easing: 'easeOutElastic(1, .8)'
    });
  }

  function animateSingleIn(el) {
    anime({
      targets: el,
      opacity: [0, 1],
      scale: [0.9, 1],
      duration: 800,
      easing: "easeOutElastic(1, .5)"
    });
  }

  async function animateDelete(el) {
    // 1. Fade out and slide right
    await anime({
      targets: el,
      opacity: 0,
      translateX: 50,
      duration: 300,
      easing: 'easeInQuint'
    }).finished;

    // 2. Collapse the height so items below slide up smoothly
    await anime({
      targets: el,
      height: 0,
      marginTop: 0,
      marginBottom: 0,
      paddingTop: 0,
      paddingBottom: 0,
      duration: 300,
      easing: 'easeInOutQuad'
    }).finished;
    
    el.remove();
  }

  function flashSuccess(el) {
    anime({
      targets: el,
      backgroundColor: ['#eef2ff', '#dcfce7', '#eef2ff'], // Blue to Green back to Blue
      duration: 1000,
      easing: 'easeInOutQuad'
    });
  }

  // --- LOGIC ---

  function createItemHTML(budget, pending = false) {
    return `
      <div class="item ${pending ? "opacity-50" : ""} group relative p-4 bg-indigo-50 border border-indigo-100 rounded-xl hover:shadow-md transition-shadow overflow-hidden" data-id="${budget.id}">
        <div class="flex justify-between items-center">
            <div class="flex flex-col">
                <span class="text-xs font-bold uppercase tracking-wider text-indigo-400">Entry</span>
                <strong class="text-slate-800 text-lg">${budget.name}</strong> 
                <small class="text-slate-500 italic">${budget.interest || 'No notes'}</small>
            </div>
            <div class="text-right">
                <span class="block text-xl font-black text-indigo-600">$${budget.amount}</span>
                <button class="text-xs text-red-400 hover:text-red-600 font-semibold underline mt-1 cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity" onclick="deleteBudget('${budget.id}')">
                  Remove
                </button>
            </div>
        </div>
      </div>
    `;
  }

  async function saveBudget() {
    if (!nameInput.value || !amountInput.value) return;

    // Button elastic feedback
    anime({
      targets: saveBtn,
      scale: [1, 0.9, 1.05, 1],
      duration: 400
    });

    const tempId = "temp-" + Date.now();
    const payload = {
      name: nameInput.value,
      amount: Number(amountInput.value),
      interest: interestInput.value
    };

    list.insertAdjacentHTML("afterbegin", createItemHTML({ ...payload, id: tempId }, true));
    const tempEl = list.querySelector(`[data-id="${tempId}"]`);
    animateSingleIn(tempEl);

    // Clear inputs
    [nameInput, amountInput, interestInput].forEach(i => i.value = "");

    try {
      const res = await fetch(API + "/budget", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!res.ok) throw new Error();
      
      // Update UI to show success
      tempEl.classList.remove('opacity-50');
      flashSuccess(tempEl);
    } catch {
      alert("Failed to save budget");
      animateDelete(tempEl);
    }
  }

  async function loadBudgets() {
    const res = await fetch(API + "/budget?ts=" + Date.now());
    const data = await res.json();

    list.innerHTML = "";
    data.forEach(budget => {
      list.insertAdjacentHTML("beforeend", createItemHTML(budget));
    });
    
    animateListIn();
  }

  async function deleteBudget(id) {
    const el = document.querySelector(`[data-id="${id}"]`);
    if (!el) return;

    await animateDelete(el);
    fetch(API + "/budget/" + id, { method: "DELETE" });
  }

  saveBtn.addEventListener("click", saveBudget);
  loadBudgets();
</script>

</body>
</html>